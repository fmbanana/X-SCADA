;(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof module==='object'&&typeof module.exports==='object'){module.exports=factory(require('jquery'));}else{factory(jQuery);}}(function($){'use strict';var $keyboard=$.keyboard=function(el,options){var o,base=this;base.version='1.25.29';base.$el=$(el);base.el=el;base.$el.data('keyboard',base);base.init=function(){var k,position,tmp,kbcss=$keyboard.css,kbevents=$keyboard.events;base.settings=options||{};if(options&&options.position){position=$.extend({},options.position);options.position=null;}
base.options=o=$.extend(true,{},$keyboard.defaultOptions,options);if(position){o.position=position;options.position=position;}
base.el.active=true;base.namespace='.keyboard'+Math.random().toString(16).slice(2);base.extensionNamespace=[];base.shiftActive=base.altActive=base.metaActive=base.sets=base.capsLock=false;base.rows=['','-shift','-alt','-alt-shift'];base.inPlaceholder=base.$el.attr('placeholder')||'';base.watermark=$keyboard.watermark&&base.inPlaceholder!=='';base.repeatTime=1000/(o.repeatRate||20);o.preventDoubleEventTime=o.preventDoubleEventTime||100;base.isOpen=false;base.wheel=$.isFunction($.fn.mousewheel);base.escapeRegex=/[-\/\\^$*+?.()|[\]{}]/g;k=$keyboard.keyCodes;base.alwaysAllowed=[k.capsLock,k.pageUp,k.pageDown,k.end,k.home,k.left,k.up,k.right,k.down,k.insert,k.delete];base.$keyboard=[];base.enabled=true;if(!$.isEmptyObject(o.position)){o.position.orig_at=o.position.at;}
base.checkCaret=(o.lockInput||$keyboard.checkCaretSupport());base.last={start:0,end:0,key:'',val:'',preVal:'',layout:'',virtual:true,keyset:[false,false,false],wheel_$Keys:null,wheelIndex:0,wheelLayers:[]};base.temp=['',0,0];$.each([kbevents.kbInit,kbevents.kbBeforeVisible,kbevents.kbVisible,kbevents.kbHidden,kbevents.inputCanceled,kbevents.inputAccepted,kbevents.kbBeforeClose],function(i,callback){if($.isFunction(o[callback])){base.$el.bind(callback+base.namespace+'callbacks',o[callback]);}});if(o.alwaysOpen){o.stayOpen=true;}
tmp=$(document);if(base.el.ownerDocument!==document){tmp=tmp.add(base.el.ownerDocument);}
tmp.bind('mousedown keyup touchstart checkkeyboard '.split(' ').join(base.namespace+' '),base.checkClose);base.$el.addClass(kbcss.input+' '+o.css.input).attr({'aria-haspopup':'true','role':'textbox'});if(o.lockInput||base.el.readOnly){o.lockInput=true;base.$el.addClass(kbcss.locked).attr({'readonly':'readonly'});}
if(base.$el.is(':disabled')||(base.$el.attr('readonly')&&!base.$el.hasClass(kbcss.locked))){base.$el.addClass(kbcss.noKeyboard);}
if(o.openOn){base.bindFocus();}
if(!base.watermark&&base.$el.val()===''&&base.inPlaceholder!==''&&base.$el.attr('placeholder')!==''){base.$el.addClass(kbcss.placeholder).val(base.inPlaceholder);}
base.$el.trigger(kbevents.kbInit,[base,base.el]);if(o.alwaysOpen){base.reveal();}};base.toggle=function(){var $toggle=base.$keyboard.find('.'+$keyboard.css.keyToggle),locked=!base.enabled;base.$preview.prop('readonly',locked||base.options.lockInput);base.$keyboard.toggleClass($keyboard.css.keyDisabled,locked).find('.'+$keyboard.css.keyButton).not($toggle).prop('disabled',locked).attr('aria-disabled',locked);$toggle.toggleClass($keyboard.css.keyDisabled,locked);if(locked&&base.typing_options){base.typing_options.text='';}};base.setCurrent=function(){var kbcss=$keyboard.css,$current=$('.'+kbcss.isCurrent),kb=$current.data('keyboard');if(!$.isEmptyObject(kb)&&kb.el!==base.el){kb.close(kb.options.autoAccept?'true':false);}
$current.removeClass(kbcss.isCurrent);$('.'+kbcss.hasFocus).removeClass(kbcss.hasFocus);base.$el.addClass(kbcss.isCurrent);base.$keyboard.addClass(kbcss.hasFocus);base.isCurrent(true);base.isOpen=true;};base.isCurrent=function(set){var cur=$keyboard.currentKeyboard||false;if(set){cur=$keyboard.currentKeyboard=base.el;}else if(set===false&&cur===base.el){cur=$keyboard.currentKeyboard='';}
return cur===base.el;};base.isVisible=function(){return base.$keyboard&&base.$keyboard.length?base.$keyboard.is(':visible'):false;};base.focusOn=function(){if(!base&&base.el.active){return;}
if(!base.isVisible()){clearTimeout(base.timer);base.reveal();}};base.redraw=function(){if(base.$keyboard.length){base.last.preVal=''+base.last.val;base.last.val=base.$preview&&base.$preview.val()||base.$el.val();base.$el.val(base.last.val);base.removeKeyboard();base.shiftActive=base.altActive=base.metaActive=false;}
base.isOpen=o.alwaysOpen;base.reveal(true);};base.reveal=function(redraw){var alreadyOpen=base.isOpen,kbcss=$keyboard.css;base.opening=!alreadyOpen;$('.'+kbcss.keyboard).not('.'+kbcss.alwaysOpen).each(function(){var kb=$(this).data('keyboard');if(!$.isEmptyObject(kb)){kb.close(kb.options.autoAccept&&kb.options.autoAcceptOnEsc?'true':false);}});if(base.$el.is(':disabled')||(base.$el.attr('readonly')&&!base.$el.hasClass(kbcss.locked))){base.$el.addClass(kbcss.noKeyboard);return;}else{base.$el.removeClass(kbcss.noKeyboard);}
if(o.openOn){base.$el.unbind($.trim((o.openOn+' ').split(/\s+/).join(base.namespace+' ')));}
if(!base.$keyboard||base.$keyboard&&(!base.$keyboard.length||$.contains(document.body,base.$keyboard[0]))){base.startup();}
if(!base.watermark&&base.el.value===base.inPlaceholder){base.$el.removeClass(kbcss.placeholder).val('');}
base.originalContent=base.$el.val();base.$preview.val(base.originalContent);if(o.acceptValid){base.checkValid();}
if(o.resetDefault){base.shiftActive=base.altActive=base.metaActive=false;}
base.showSet();if(!base.isVisible()){base.$el.trigger($keyboard.events.kbBeforeVisible,[base,base.el]);}
base.setCurrent();base.toggle();base.$keyboard.show();if(o.usePreview&&$keyboard.msie){if(typeof base.width==='undefined'){base.$preview.hide();base.width=Math.ceil(base.$keyboard.width());base.$preview.show();}
base.$preview.width(base.width);}
base.position=$.isEmptyObject(o.position)?false:o.position;if($.ui&&$.ui.position&&base.position){base.position.of=base.position.of||base.$el.data('keyboardPosition')||base.$el;base.position.collision=base.position.collision||'flipfit flipfit';o.position.at=o.usePreview?o.position.orig_at:o.position.at2;base.$keyboard.position(base.position);}
base.checkDecimal();base.lineHeight=parseInt(base.$preview.css('lineHeight'),10)||parseInt(base.$preview.css('font-size'),10)+4;if(o.caretToEnd){base.saveCaret(base.originalContent.length,base.originalContent.length);}
if($keyboard.allie){if(base.last.end===0&&base.last.start>0){base.last.end=base.last.start;}
if(base.last.start<0){base.last.start=base.last.end=base.originalContent.length;}}
if(alreadyOpen||redraw){$keyboard.caret(base.$preview,base.last);return base;}
base.timer2=setTimeout(function(){var undef;base.opening=false;if(!/(number|email)/i.test(base.el.type)&&!o.caretToEnd){base.saveCaret(undef,undef,base.$el);}
if(o.initialFocus){$keyboard.caret(base.$preview,base.last);}
base.last.eventTime=new Date().getTime();base.$el.trigger($keyboard.events.kbVisible,[base,base.el]);base.timer=setTimeout(function(){if(base){base.saveCaret();}},200);},10);return base;};base.updateLanguage=function(){var layouts=$keyboard.layouts,lang=o.language||layouts[o.layout]&&layouts[o.layout].lang&&layouts[o.layout].lang||[o.language||'en'],kblang=$keyboard.language;lang=($.isArray(lang)?lang[0]:lang).split('-')[0];o.display=$.extend(true,{},kblang.en.display,kblang[lang]&&kblang[lang].display||{},base.settings.display);o.combos=$.extend(true,{},kblang.en.combos,kblang[lang]&&kblang[lang].combos||{},base.settings.combos);o.wheelMessage=kblang[lang]&&kblang[lang].wheelMessage||kblang.en.wheelMessage;o.rtl=layouts[o.layout]&&layouts[o.layout].rtl||kblang[lang]&&kblang[lang].rtl||false;base.regex=kblang[lang]&&kblang[lang].comboRegex||$keyboard.comboRegex;base.decimal=/^\./.test(o.display.dec);base.$el.toggleClass('rtl',o.rtl).css('direction',o.rtl?'rtl':'');};base.startup=function(){var kbcss=$keyboard.css;if(!((o.alwaysOpen||o.userClosed)&&base.$preview)){base.makePreview();}
if(!(base.$keyboard&&base.$keyboard.length)){if(o.layout==='custom'){o.layoutHash='custom'+base.customHash();}
base.layout=o.layout==='custom'?o.layoutHash:o.layout;base.last.layout=base.layout;base.updateLanguage();if(typeof $keyboard.builtLayouts[base.layout]==='undefined'){if($.isFunction(o.create)){base.$keyboard=o.create(base);}else if(!base.$keyboard.length){base.buildKeyboard(base.layout,true);}}
base.$keyboard=$keyboard.builtLayouts[base.layout].$keyboard.clone();base.$keyboard.data('keyboard',base);if((base.el.id||'')!==''){base.$keyboard.attr('id',base.el.id+$keyboard.css.idSuffix);}
base.makePreview();if(o.usePreview){if(!$.isEmptyObject(o.position)){o.position.at=o.position.orig_at;}}else{if(!$.isEmptyObject(o.position)){o.position.at=o.position.at2;}}}
base.$decBtn=base.$keyboard.find('.'+kbcss.keyPrefix+'dec');if(o.enterNavigation||base.el.nodeName==='TEXTAREA'){base.alwaysAllowed.push(13);}
base.bindKeyboard();base.$keyboard.appendTo(o.appendLocally?base.$el.parent():o.appendTo||'body');base.bindKeys();if(o.reposition&&$.ui&&$.ui.position&&o.appendTo=='body'){$(window).bind('resize'+base.namespace,function(){if(base.position&&base.isVisible()){base.$keyboard.position(base.position);}});}};base.makePreview=function(){if(o.usePreview){var indx,attrs,attr,removedAttr,kbcss=$keyboard.css;base.$preview=base.$el.clone(false).data('keyboard',base).removeClass(kbcss.placeholder+' '+kbcss.input).addClass(kbcss.preview+' '+o.css.input).attr('tabindex','-1').show();base.preview=base.$preview[0];if(base.preview.type==='number'){base.preview.type='text';}
removedAttr=/^(data-|id|aria-haspopup)/i;attrs=base.$preview.get(0).attributes;for(indx=attrs.length-1;indx>=0;indx--){attr=attrs[indx]&&attrs[indx].name;if(removedAttr.test(attr)){base.preview.removeAttribute(attr);}}
$('<div />').addClass(kbcss.wrapper).append(base.$preview).prependTo(base.$keyboard);}else{base.$preview=base.$el;base.preview=base.el;}};base.saveCaret=function(start,end,$el){var p=$keyboard.caret($el||base.$preview,start,end);base.last.start=typeof start==='undefined'?p.start:start;base.last.end=typeof end==='undefined'?p.end:end;};base.setScroll=function(){if(base.last.virtual){var scrollWidth,clientWidth,adjustment,direction,isTextarea=base.preview.nodeName==='TEXTAREA',value=base.last.val.substring(0,Math.max(base.last.start,base.last.end));if(!base.$previewCopy){base.$previewCopy=base.$preview.clone().removeAttr('id').css({position:'absolute',left:0,zIndex:-10,visibility:'hidden'}).addClass($keyboard.css.inputClone);if(!isTextarea){base.$previewCopy.css({'white-space':'pre','width':0});}
if(o.usePreview){base.$preview.after(base.$previewCopy);}else{base.$keyboard.prepend(base.$previewCopy);}}
if(isTextarea){base.$previewCopy.height(base.lineHeight).val(value);base.preview.scrollTop=base.lineHeight*(Math.floor(base.$previewCopy[0].scrollHeight/base.lineHeight)-1);}else{base.$previewCopy.val(value.replace(/\s/g,'\xa0'));adjustment=/c/i.test(o.scrollAdjustment)?base.preview.clientWidth/2:o.scrollAdjustment;scrollWidth=base.$previewCopy[0].scrollWidth-1;if(typeof base.last.scrollWidth==='undefined'){base.last.scrollWidth=scrollWidth;base.last.direction=true;}
direction=base.last.scrollWidth===scrollWidth?base.last.direction:base.last.scrollWidth<scrollWidth;clientWidth=base.preview.clientWidth-adjustment;if(direction){if(scrollWidth<clientWidth){base.preview.scrollLeft=0;}else{base.preview.scrollLeft=scrollWidth-clientWidth;}}else{if(scrollWidth>=base.preview.scrollWidth-clientWidth){base.preview.scrollLeft=base.preview.scrollWidth-adjustment;}else if(scrollWidth-adjustment>0){base.preview.scrollLeft=scrollWidth-adjustment;}else{base.preview.scrollLeft=0;}}
base.last.scrollWidth=scrollWidth;base.last.direction=direction;}}};base.bindFocus=function(){if(o.openOn){if(base&&base.el.active){base.$el.bind(o.openOn+base.namespace,function(){base.focusOn();});if($(':focus')[0]===base.el){base.$el.blur();}}}};base.bindKeyboard=function(){var evt,keyCodes=$keyboard.keyCodes,layout=$keyboard.builtLayouts[base.layout];base.$preview.unbind(base.namespace).bind('click'+base.namespace+' touchstart'+base.namespace,function(){if(o.alwaysOpen&&!base.isCurrent()){base.reveal();}
base.timer2=setTimeout(function(){if(base){base.saveCaret();}},150);}).bind('keypress'+base.namespace,function(e){if(o.lockInput||!base.isCurrent()){return false;}
var k=e.charCode||e.which,k1=k>=keyCodes.A&&k<=keyCodes.Z,k2=k>=keyCodes.a&&k<=keyCodes.z,str=base.last.key=String.fromCharCode(k);base.last.virtual=false;base.last.event=e;base.last.$key=[];if(base.checkCaret){base.saveCaret();}
if(k!==keyCodes.capsLock&&(k1||k2)){base.capsLock=(k1&&!e.shiftKey)||(k2&&e.shiftKey);if(base.capsLock&&!base.shiftActive){base.shiftActive=true;base.showSet();}}
if(o.restrictInput){if((e.which===keyCodes.backSpace||e.which===0)&&$.inArray(e.keyCode,base.alwaysAllowed)){return;}
if($.inArray(str,layout.acceptedKeys)===-1){e.preventDefault();evt=$.extend({},e);evt.type=$keyboard.events.inputRestricted;base.$el.trigger(evt,[base,base.el]);if($.isFunction(o.restricted)){o.restricted(evt,base,base.el);}}}else if((e.ctrlKey||e.metaKey)&&(e.which===keyCodes.A||e.which===keyCodes.C||e.which===keyCodes.V||(e.which>=keyCodes.X&&e.which<=keyCodes.Z))){return;}
if(layout.hasMappedKeys&&layout.mappedKeys.hasOwnProperty(str)){base.last.key=layout.mappedKeys[str];base.insertText(base.last.key);e.preventDefault();}
base.checkMaxLength();}).bind('keyup'+base.namespace,function(e){if(!base.isCurrent()){return;}
base.last.virtual=false;switch(e.which){case keyCodes.tab:if(base.tab&&o.tabNavigation&&!o.lockInput){base.shiftActive=e.shiftKey;var notSwitching=$keyboard.keyaction.tab(base);base.tab=false;if(!notSwitching){return false;}}else{e.preventDefault();}
break;case keyCodes.escape:if(!o.ignoreEsc){base.close(o.autoAccept&&o.autoAcceptOnEsc?'true':false);}
return false;}
clearTimeout(base.throttled);base.throttled=setTimeout(function(){if(base&&base.isVisible()){base.checkCombos();}},100);base.checkMaxLength();base.last.preVal=''+base.last.val;base.last.val=base.$preview.val();e.type=$keyboard.events.kbChange;e.action=base.last.key;base.$el.trigger(e,[base,base.el]);if($.isFunction(o.change)){e.type=$keyboard.events.inputChange;o.change(e,base,base.el);return false;}
if(o.acceptValid&&o.autoAcceptOnValid){if($.isFunction(o.validate)&&o.validate(base,base.$preview.val())){base.$preview.blur();base.accept();}}}).bind('keydown'+base.namespace,function(e){if(o.alwaysOpen&&!base.isCurrent()){base.reveal();}
if(e.which===keyCodes.tab){base.tab=true;return false;}
if(o.lockInput){return false;}
base.last.virtual=false;switch(e.which){case keyCodes.backSpace:$keyboard.keyaction.bksp(base,null,e);e.preventDefault();break;case keyCodes.enter:$keyboard.keyaction.enter(base,null,e);break;case keyCodes.capsLock:base.shiftActive=base.capsLock=!base.capsLock;base.showSet();break;case keyCodes.V:if(e.ctrlKey||e.metaKey){if(o.preventPaste){e.preventDefault();return;}
base.checkCombos();}
break;}}).bind('mouseup touchend '.split(' ').join(base.namespace+' '),function(){base.last.virtual=true;base.saveCaret();});base.$keyboard.bind('mousedown click touchstart '.split(' ').join(base.namespace+' '),function(e){e.stopPropagation();if(!base.isCurrent()){base.reveal();$(document).trigger('checkkeyboard'+base.namespace);}
if(!o.noFocus){base.$preview.focus();}});if(o.preventPaste){base.$preview.bind('contextmenu'+base.namespace,function(e){e.preventDefault();});base.$el.bind('contextmenu'+base.namespace,function(e){e.preventDefault();});}};base.bindKeys=function(){var kbcss=$keyboard.css;base.$allKeys=base.$keyboard.find('button.'+kbcss.keyButton).unbind(base.namespace+' '+base.namespace+'kb').bind('mouseenter mouseleave touchstart '.split(' ').join(base.namespace+' '),function(e){if((o.alwaysOpen||o.userClosed)&&e.type!=='mouseleave'&&!base.isCurrent()){base.reveal();base.$preview.focus();$keyboard.caret(base.$preview,base.last);}
if(!base.isCurrent()){return;}
var $keys,txt,last=base.last,$this=$(this),type=e.type;if(o.useWheel&&base.wheel){$keys=base.getLayers($this);txt=($keys.length?$keys.map(function(){return $(this).attr('data-value')||'';}).get():'')||[$this.text()];last.wheel_$Keys=$keys;last.wheelLayers=txt;last.wheelIndex=$.inArray($this.attr('data-value'),txt);}
if((type==='mouseenter'||type==='touchstart')&&base.el.type!=='password'&&!$this.hasClass(o.css.buttonDisabled)){$this.addClass(o.css.buttonHover);if(o.useWheel&&base.wheel){$this.attr('title',function(i,t){return(base.wheel&&t===''&&base.sets&&txt.length>1&&type!=='touchstart')?o.wheelMessage:t;});}}
if(type==='mouseleave'){$this.removeClass((base.el.type==='password')?'':o.css.buttonHover);if(o.useWheel&&base.wheel){last.wheelIndex=0;last.wheelLayers=[];last.wheel_$Keys=null;$this.attr('title',function(i,t){return(t===o.wheelMessage)?'':t;}).html($this.attr('data-html'));}}}).bind(o.keyBinding.split(' ').join(base.namespace+' ')+base.namespace+' '+
$keyboard.events.kbRepeater,function(e){e.preventDefault();if(!base.$keyboard.is(':visible')){return false;}
var action,$keys,last=base.last,key=this,$key=$(key),timer=new Date().getTime();if(o.useWheel&&base.wheel){$keys=last.wheel_$Keys;$key=$keys&&last.wheelIndex>-1?$keys.eq(last.wheelIndex):$key;}
action=$key.attr('data-action');if(timer-(last.eventTime||0)<o.preventDoubleEventTime){return;}
last.eventTime=timer;last.event=e;last.virtual=true;if(!o.noFocus){base.$preview.focus();}
last.$key=$key;last.key=$key.attr('data-value');if(base.checkCaret){$keyboard.caret(base.$preview,last);}
if(action.match('meta')){action='meta';}
if(action===last.key&&typeof $keyboard.keyaction[action]==='string'){last.key=action=$keyboard.keyaction[action];}else if(action in $keyboard.keyaction&&$.isFunction($keyboard.keyaction[action])){if($keyboard.keyaction[action](base,this,e)===false){return false;}
action=null;}
if(typeof action!=='undefined'&&action!==null){last.key=$(this).hasClass(kbcss.keyAction)?action:last.key;base.insertText(last.key);if(!base.capsLock&&!o.stickyShift&&!e.shiftKey){base.shiftActive=false;base.showSet($key.attr('data-name'));}}
$keyboard.caret(base.$preview,last);base.checkCombos();e.type=$keyboard.events.kbChange;e.action=last.key;base.$el.trigger(e,[base,base.el]);last.preVal=''+last.val;last.val=base.$preview.val();if($.isFunction(o.change)){e.type=$keyboard.events.inputChange;o.change(e,base,base.el);return false;}}).bind('mouseup'+base.namespace+' '+'mouseleave touchend touchmove touchcancel '.split(' ').join(base.namespace+'kb '),function(e){base.last.virtual=true;var offset,$this=$(this);if(e.type==='touchmove'){offset=$this.offset();offset.right=offset.left+$this.outerWidth();offset.bottom=offset.top+$this.outerHeight();if(e.originalEvent.touches[0].pageX>=offset.left&&e.originalEvent.touches[0].pageX<offset.right&&e.originalEvent.touches[0].pageY>=offset.top&&e.originalEvent.touches[0].pageY<offset.bottom){return true;}}else if(/(mouseleave|touchend|touchcancel)/i.test(e.type)){$this.removeClass(o.css.buttonHover);}else{if(!o.noFocus&&base.isCurrent()&&base.isVisible()){base.$preview.focus();}
if(base.checkCaret){$keyboard.caret(base.$preview,base.last);}}
base.mouseRepeat=[false,''];clearTimeout(base.repeater);if(o.acceptValid&&o.autoAcceptOnValid){if($.isFunction(o.validate)&&o.validate(base,base.$preview.val())){base.$preview.blur();base.accept();}}
return false;}).bind('click'+base.namespace,function(){return false;}).not('.'+kbcss.keyAction).bind('mousewheel'+base.namespace,function(e,delta){if(o.useWheel&&base.wheel){delta=delta||e.deltaY;var n,txt=base.last.wheelLayers||[];if(txt.length>1){n=base.last.wheelIndex+(delta>0?-1:1);if(n>txt.length-1){n=0;}
if(n<0){n=txt.length-1;}}else{n=0;}
base.last.wheelIndex=n;$(this).html(txt[n]);return false;}}).add('.'+kbcss.keyPrefix+('tab bksp space enter'.split(' ').join(',.'+kbcss.keyPrefix)),base.$keyboard).bind('mousedown touchstart '.split(' ').join(base.namespace+'kb '),function(){if(o.repeatRate!==0){var key=$(this);base.mouseRepeat=[true,key];setTimeout(function(){if(base&&base.mouseRepeat[0]&&base.mouseRepeat[1]===key&&!key[0].disabled){base.repeatKey(key);}},o.repeatDelay);}
return false;});};base.insertText=function(txt){if(typeof txt==='undefined'){return;}
var bksp,t,isBksp=txt==='\b',val=base.$preview.val(),pos=$keyboard.caret(base.$preview),len=val.length;if(pos.end<pos.start){pos.end=pos.start;}
if(pos.start>len){pos.end=pos.start=len;}
if(base.preview.nodeName==='TEXTAREA'){if($keyboard.msie&&val.substr(pos.start,1)==='\n'){pos.start+=1;pos.end+=1;}}
if(txt==='{d}'){txt='';t=pos.start;pos.end+=1;}
bksp=isBksp&&pos.start===pos.end;txt=isBksp?'':txt;val=val.substr(0,pos.start-(bksp?1:0))+txt+val.substr(pos.end);t=pos.start+(bksp?-1:txt.length);base.$preview.val(val);base.saveCaret(t,t);base.setScroll();};base.checkMaxLength=function(){if(!base.isCurrent()){return;}
var start,caret,val=base.$preview.val();if(o.maxLength!==false&&val.length>o.maxLength){start=$keyboard.caret(base.$preview).start;caret=Math.min(start,o.maxLength);if(!o.maxInsert){val=base.last.val;caret=start-1;}
base.$preview.val(val.substring(0,o.maxLength));base.saveCaret(caret,caret);}
if(base.$decBtn.length){base.checkDecimal();}};base.repeatKey=function(key){key.trigger($keyboard.events.kbRepeater);if(base.mouseRepeat[0]){base.repeater=setTimeout(function(){if(base){base.repeatKey(key);}},base.repeatTime);}};base.showKeySet=function(str){if(typeof str==='string'){base.last.keyset=[base.shiftActive,base.altActive,base.metaActive];base.shiftActive=/shift/i.test(str);base.altActive=/alt/i.test(str);if(/meta/.test(str)){base.metaActive=true;base.showSet(str.match(/meta\d+/i)[0]);}else{base.metaActive=false;base.showSet();}}else{base.showSet(str);}};base.showSet=function(name){o=base.options;var kbcss=$keyboard.css,prefix='.'+kbcss.keyPrefix,active=o.css.buttonActive,key='',toShow=(base.shiftActive?1:0)+(base.altActive?2:0);if(!base.shiftActive){base.capsLock=false;}
if(base.metaActive){key=(/meta/i.test(name))?name:'';if(key===''){key=(base.metaActive===true)?'':base.metaActive;}else{base.metaActive=key;}
if((!o.stickyShift&&base.last.keyset[2]!==base.metaActive)||((base.shiftActive||base.altActive)&&!base.$keyboard.find('.'+kbcss.keySet+'-'+key+base.rows[toShow]).length)){base.shiftActive=base.altActive=false;}}else if(!o.stickyShift&&base.last.keyset[2]!==base.metaActive&&base.shiftActive){base.shiftActive=base.altActive=false;}
toShow=(base.shiftActive?1:0)+(base.altActive?2:0);key=(toShow===0&&!base.metaActive)?'-normal':(key==='')?'':'-'+key;if(!base.$keyboard.find('.'+kbcss.keySet+key+base.rows[toShow]).length){base.shiftActive=base.last.keyset[0];base.altActive=base.last.keyset[1];base.metaActive=base.last.keyset[2];return;}
base.$keyboard.find(prefix+'alt,'+prefix+'shift,.'+kbcss.keyAction+'[class*=meta]').removeClass(active).end().find(prefix+'alt').toggleClass(active,base.altActive).end().find(prefix+'shift').toggleClass(active,base.shiftActive).end().find(prefix+'lock').toggleClass(active,base.capsLock).end().find('.'+kbcss.keySet).hide().end().find('.'+kbcss.keyAction+prefix+key).addClass(active);base.$keyboard.find('.'+kbcss.keySet+key+base.rows[toShow])[0].style.display='inline-block';if(base.metaActive){base.$keyboard.find(prefix+base.metaActive).toggleClass(active,base.metaActive!==false);}
base.last.keyset=[base.shiftActive,base.altActive,base.metaActive];base.$el.trigger($keyboard.events.kbKeysetChange,[base,base.el]);};base.checkCombos=function(){if(!(base.isVisible()||base.$keyboard.hasClass($keyboard.css.hasFocus))){return base.$preview.val();}
var r,t,t2,val=base.$preview.val(),pos=$keyboard.caret(base.$preview),layout=$keyboard.builtLayouts[base.layout],len=val.length;if(val===''){if(o.acceptValid){base.checkValid();}
return val;}
if(pos.end<pos.start){pos.end=pos.start;}
if(pos.start>len){pos.end=pos.start=len;}
if($keyboard.msie&&val.substr(pos.start,1)==='\n'){pos.start+=1;pos.end+=1;}
if(o.useCombos){if($keyboard.msie){val=val.replace(base.regex,function(s,accent,letter){return(o.combos.hasOwnProperty(accent))?o.combos[accent][letter]||s:s;});}else if(base.$preview.length){t=pos.start-(pos.start-2>=0?2:0);$keyboard.caret(base.$preview,t,pos.end);t2=($keyboard.caret(base.$preview).text||'').replace(base.regex,function(s,accent,letter){return(o.combos.hasOwnProperty(accent))?o.combos[accent][letter]||s:s;});base.$preview.val($keyboard.caret(base.$preview).replaceStr(t2));val=base.$preview.val();}}
if(o.restrictInput&&val!==''){t=layout.acceptedKeys.length;r=layout.acceptedKeysRegex;if(!r){t2=$.map(layout.acceptedKeys,function(v){return v.replace(base.escapeRegex,'\\$&');});r=layout.acceptedKeysRegex=new RegExp('('+t2.join('|')+')','g');}
t2=val.match(r);if(t2){val=t2.join('');}else{val='';len=0;}}
pos.start+=val.length-len;pos.end+=val.length-len;base.$preview.val(val);base.saveCaret(pos.start,pos.end);base.setScroll();base.checkMaxLength();if(o.acceptValid){base.checkValid();}
return val;};base.checkValid=function(){var kbcss=$keyboard.css,$accept=base.$keyboard.find('.'+kbcss.keyPrefix+'accept'),valid=true;if($.isFunction(o.validate)){valid=o.validate(base,base.$preview.val(),false);}
$accept.toggleClass(kbcss.inputInvalid,!valid).toggleClass(kbcss.inputValid,valid).attr('title',$accept.attr('data-title')+' ('+o.display[valid?'valid':'invalid']+')');};base.checkDecimal=function(){if((base.decimal&&/\./g.test(base.preview.value))||(!base.decimal&&/\,/g.test(base.preview.value))){base.$decBtn.attr({'disabled':'disabled','aria-disabled':'true'}).removeClass(o.css.buttonHover).addClass(o.css.buttonDisabled);}else{base.$decBtn.removeAttr('disabled').attr({'aria-disabled':'false'}).addClass(o.css.buttonDefault).removeClass(o.css.buttonDisabled);}};base.getLayers=function($el){var kbcss=$keyboard.css,key=$el.attr('data-pos'),$keys=$el.closest('.'+kbcss.keyboard).find('button[data-pos="'+key+'"]');return $keys.filter(function(){return $(this).find('.'+kbcss.keyText).text()!=='';}).add($el);};base.switchInput=function(goToNext,isAccepted){if($.isFunction(o.switchInput)){o.switchInput(base,goToNext,isAccepted);}else{if(base.$keyboard.length){base.$keyboard.hide();}
var kb,stopped=false,all=$('button, input, textarea, a').filter(':visible').not(':disabled'),indx=all.index(base.$el)+(goToNext?1:-1);if(base.$keyboard.length){base.$keyboard.show();}
if(indx>all.length-1){stopped=o.stopAtEnd;indx=0;}
if(indx<0){stopped=o.stopAtEnd;indx=all.length-1;}
if(!stopped){isAccepted=base.close(isAccepted);if(!isAccepted){return;}
kb=all.eq(indx).data('keyboard');if(kb&&kb.options.openOn.length){kb.focusOn();}else{all.eq(indx).focus();}}}
return false;};base.close=function(accepted){if(base.isOpen&&base.$keyboard.length){clearTimeout(base.throttled);var kbcss=$keyboard.css,kbevents=$keyboard.events,val=(accepted)?base.checkCombos():base.originalContent;if(accepted&&$.isFunction(o.validate)&&!o.validate(base,val,true)){val=base.originalContent;accepted=false;if(o.cancelClose){return;}}
base.isCurrent(false);base.isOpen=o.alwaysOpen||o.userClosed;base.$preview.val(val);base.$el.removeClass(kbcss.isCurrent+' '+kbcss.inputAutoAccepted).addClass((accepted||false)?accepted===true?'':kbcss.inputAutoAccepted:'').val(val).trigger(kbevents.inputChange);if(!o.alwaysOpen){base.$el.trigger(kbevents.kbBeforeClose,[base,base.el,(accepted||false)]);}
base.$el.trigger(((accepted||false)?kbevents.inputAccepted:kbevents.inputCanceled),[base,base.el]).trigger((o.alwaysOpen)?kbevents.kbInactive:kbevents.kbHidden,[base,base.el]).blur();$keyboard.caret(base.$preview,base.last);if(base){base.last.eventTime=new Date().getTime();if(!(o.alwaysOpen||o.userClosed&&accepted==='true')&&base.$keyboard.length){base.removeKeyboard();base.timer=setTimeout(function(){if(base){base.bindFocus();}},500);}
if(!base.watermark&&base.el.value===''&&base.inPlaceholder!==''){base.$el.addClass(kbcss.placeholder).val(base.inPlaceholder);}}}
return!!accepted;};base.accept=function(){return base.close(true);};base.checkClose=function(e){if(base.opening){return;}
base.escClose(e);var kbcss=$.keyboard.css,$target=$(e.target);if($target.hasClass(kbcss.input)){var kb=$target.data('keyboard');if(kb===base&&!kb.$el.hasClass(kbcss.isCurrent)&&e.type===kb.options.openOn){kb.focusOn();}}};base.escClose=function(e){if(e&&e.type==='keyup'){return(e.which===$keyboard.keyCodes.escape&&!o.ignoreEsc)?base.close(o.autoAccept&&o.autoAcceptOnEsc?'true':false):'';}
if(!base.isOpen){return;}
if(!base.isCurrent()&&base.isOpen||base.isOpen&&e.target!==base.el){if((o.stayOpen||o.userClosed)&&!$(e.target).hasClass($keyboard.css.input)){return;}
if($keyboard.allie){e.preventDefault();}
base.close(o.autoAccept?'true':false);}};base.keyBtn=$('<button />').attr({'role':'button','type':'button','aria-disabled':'false','tabindex':'-1'}).addClass($keyboard.css.keyButton);base.processName=function(name){var index,n,process=(name||'').replace(/[^a-z0-9-_]/gi,''),len=process.length,newName=[];if(len>1&&name===process){return name;}
len=name.length;if(len){for(index=0;index<len;index++){n=name[index];newName.push(/[a-z0-9-_]/i.test(n)?(/[-_]/.test(n)&&index!==0?'':n):(index===0?'':'-')+n.charCodeAt(0));}
return newName.join('');}else{return name;}};base.processKeys=function(name){var tmp,parts=name.split(':'),data={name:null,map:'',title:''};if(/\(.+\)/.test(parts[0])||/^:\(.+\)/.test(name)||/\([(:)]\)/.test(name)){if(/\([(:)]\)/.test(name)){tmp=parts[0].match(/([^(]+)\((.+)\)/);if(tmp&&tmp.length){data.name=tmp[1];data.map=tmp[2];data.title=parts.length>1?parts.slice(1).join(':'):'';}else{data.name=name.match(/([^(]+)/)[0];if(data.name===':'){parts=parts.slice(1);}
if(tmp===null){data.map=':';parts=parts.slice(2);}
data.title=parts.length?parts.join(':'):'';}}else{data.map=name.match(/\(([^()]+?)\)/)[1];name=name.replace(/\(([^()]+)\)/,'');tmp=name.split(':');if(tmp[0]===''){data.name=':';parts=parts.slice(1);}else{data.name=tmp[0];}
data.title=parts.length>1?parts.slice(1).join(':'):'';}}else{if(parts[0]===''){data.name=':';parts=parts.slice(1);}else{data.name=parts[0];}
data.title=parts.length>1?parts.slice(1).join(':'):'';}
data.title=$.trim(data.title).replace(/_/g,' ');return data;};base.addKey=function(keyName,action,regKey){var keyClass,tmp,keys,data={},txt=base.processKeys(regKey?keyName:action),kbcss=$keyboard.css;if(!regKey&&o.display[txt.name]){keys=base.processKeys(o.display[txt.name]);keys.action=base.processKeys(keyName).name;}else{keys=txt;keys.action=txt.name;}
data.name=base.processName(txt.name);if(keys.map!==''){$keyboard.builtLayouts[base.layout].mappedKeys[keys.map]=keys.name;$keyboard.builtLayouts[base.layout].acceptedKeys.push(keys.name);}else if(regKey){$keyboard.builtLayouts[base.layout].acceptedKeys.push(keys.name);}
if(regKey){keyClass=data.name===''?'':kbcss.keyPrefix+data.name;}else{keyClass=kbcss.keyAction+' '+kbcss.keyPrefix+keys.action;}
keyClass+=(keys.name.length>2?' '+kbcss.keyWide:'')+' '+o.css.buttonDefault;data.html='<span class="'+kbcss.keyText+'">'+
keys.name.replace(/[\u00A0-\u9999]/gim,function(i){return'&#'+i.charCodeAt(0)+';';})+'</span>';data.$key=base.keyBtn.clone().attr({'data-value':regKey?keys.name:keys.action,'data-name':keys.action,'data-pos':base.temp[1]+','+base.temp[2],'data-action':keys.action,'data-html':data.html}).addClass(keyClass).html(data.html).appendTo(base.temp[0]);if(keys.map){data.$key.attr('data-mapped',keys.map);}
if(keys.title||txt.title){data.$key.attr({'data-title':txt.title||keys.title,'title':txt.title||keys.title});}
if(typeof o.buildKey==='function'){data=o.buildKey(base,data);tmp=data.$key.html();data.$key.attr('data-html',tmp);}
return data.$key;};base.customHash=function(layout){var i,array,hash,character,len,arrays=[],merged=[];layout=typeof layout==='undefined'?o.customLayout:layout;for(array in layout){if(layout.hasOwnProperty(array)){arrays.push(layout[array]);}}
merged=merged.concat.apply(merged,arrays).join(' ');hash=0;len=merged.length;if(len===0){return hash;}
for(i=0;i<len;i++){character=merged.charCodeAt(i);hash=((hash<<5)-hash)+character;hash=hash&hash;}
return hash;};base.buildKeyboard=function(name,internal){if($.isEmptyObject(o.display)){base.updateLanguage();}
var row,$row,currentSet,kbcss=$keyboard.css,sets=0,layout=$keyboard.builtLayouts[name||base.layout||o.layout]={mappedKeys:{},acceptedKeys:[]},acceptedKeys=layout.acceptedKeys=o.restrictInclude?(''+o.restrictInclude).split(/\s+/)||[]:[],$layout=kbcss.keyboard+' '+o.css.popup+' '+o.css.container+
(o.alwaysOpen||o.userClosed?' '+kbcss.alwaysOpen:''),container=$('<div />').addClass($layout).attr({'role':'textbox'}).hide();if((internal&&o.layout==='custom')||!$keyboard.layouts.hasOwnProperty(o.layout)){o.layout='custom';$layout=$keyboard.layouts.custom=o.customLayout||{'normal':['{cancel}']};}else{$layout=$keyboard.layouts[internal?o.layout:name||base.layout||o.layout];}
$.each($layout,function(set,keySet){if(set!==''&&!/^(name|lang|rtl)$/i.test(set)){if(set==='default'){set='normal';}
sets++;$row=$('<div />').attr('name',set).addClass(kbcss.keySet+' '+kbcss.keySet+'-'+set).appendTo(container).toggle(set==='normal');for(row=0;row<keySet.length;row++){currentSet=$.trim(keySet[row]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,'{$1:$2}');base.buildRow($row,row,currentSet.split(/\s+/),acceptedKeys);$row.find('.'+kbcss.keyButton+',.'+kbcss.keySpacer).filter(':last').after('<br class="'+kbcss.endRow+'"/>');}}});if(sets>1){base.sets=true;}
layout.hasMappedKeys=!($.isEmptyObject(layout.mappedKeys));layout.$keyboard=container;return container;};base.buildRow=function($row,row,keys,acceptedKeys){var t,txt,key,isAction,action,margin,kbcss=$keyboard.css;for(key=0;key<keys.length;key++){base.temp=[$row,row,key];isAction=false;if(keys[key].length===0){continue;}
if(/^\{\S+\}$/.test(keys[key])){action=keys[key].match(/^\{(\S+)\}$/)[1];if(/\!\!/.test(action)){action=action.replace('!!','');isAction=true;}
if(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i.test(action)){margin=parseFloat(action.replace(/,/,'.').match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0);$('<span class="'+kbcss.keyText+'"></span>').width((action.match(/px/i)?margin+'px':(margin*2)+'em')).addClass(kbcss.keySpacer).appendTo($row);}
if(/^empty(:((\d+)?([\.|,]\d+)?)(em|px)?)?$/i.test(action)){margin=(/:/.test(action))?parseFloat(action.replace(/,/,'.').match(/^empty:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0):'';base.addKey('',' ').addClass(o.css.buttonDisabled+' '+o.css.buttonEmpty).attr('aria-disabled',true).width(margin?(action.match('px')?margin+'px':(margin*2)+'em'):'');}
if(/^meta\d+\:?(\w+)?/i.test(action)){base.addKey(action.split(':')[0],action).addClass(kbcss.keyHasActive);continue;}
txt=action.split(':');switch(txt[0].toLowerCase()){case'a':case'accept':base.addKey('accept',action).addClass(o.css.buttonAction+' '+kbcss.keyAction);break;case'alt':case'altgr':base.addKey('alt',action).addClass(kbcss.keyHasActive);break;case'b':case'bksp':base.addKey('bksp',action);break;case'c':case'cancel':base.addKey('cancel',action).addClass(o.css.buttonAction+' '+kbcss.keyAction);break;case'combo':base.addKey('combo',action).addClass(kbcss.keyHasActive).attr('title',function(indx,title){return title+' '+o.display[o.useCombos?'active':'disabled'];}).toggleClass(o.css.buttonActive,o.useCombos);break;case'dec':acceptedKeys.push((base.decimal)?'.':',');base.addKey('dec',action);break;case'e':case'enter':base.addKey('enter',action).addClass(o.css.buttonAction+' '+kbcss.keyAction);break;case'lock':base.addKey('lock',action).addClass(kbcss.keyHasActive);break;case's':case'shift':base.addKey('shift',action).addClass(kbcss.keyHasActive);break;case'sign':acceptedKeys.push('-');base.addKey('sign',action);break;case'space':acceptedKeys.push(' ');base.addKey('space',action);break;case't':case'tab':base.addKey('tab',action);break;default:if($keyboard.keyaction.hasOwnProperty(txt[0])){base.addKey(txt[0],action).toggleClass(o.css.buttonAction+' '+kbcss.keyAction,isAction);}}}else{t=keys[key];base.addKey(t,t,true);}}};base.removeBindings=function(namespace){$(document).unbind(namespace);if(base.el.ownerDocument!==document){$(base.el.ownerDocument).unbind(namespace);}
$(window).unbind(namespace);base.$el.unbind(namespace);};base.removeKeyboard=function(){base.$allKeys=null;base.$decBtn=null;if(o.usePreview){base.$preview.removeData('keyboard');}
base.preview=null;base.$preview=null;base.$previewCopy=null;base.$keyboard.removeData('keyboard');base.$keyboard.remove();base.$keyboard=[];base.isOpen=false;base.isCurrent(false);};base.destroy=function(callback){var index,kbcss=$keyboard.css,len=base.extensionNamespace.length,tmp=[kbcss.input,kbcss.locked,kbcss.placeholder,kbcss.noKeyboard,kbcss.alwaysOpen,o.css.input,kbcss.isCurrent].join(' ');clearTimeout(base.timer);clearTimeout(base.timer2);if(base.$keyboard.length){base.removeKeyboard();}
base.removeBindings(base.namespace);base.removeBindings(base.namespace+'callbacks');for(index=0;index<len;index++){base.removeBindings(base.extensionNamespace[index]);}
base.el.active=false;base.$el.removeClass(tmp).removeAttr('aria-haspopup').removeAttr('role').removeData('keyboard');base=null;if(typeof callback==='function'){callback();}};base.init();};$keyboard.keyCodes={backSpace:8,tab:9,enter:13,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,A:65,Z:90,V:86,C:67,X:88,a:97,z:122};$keyboard.css={idSuffix:'_keyboard',input:'ui-keyboard-input',inputClone:'ui-keyboard-preview-clone',wrapper:'ui-keyboard-preview-wrapper',preview:'ui-keyboard-preview',keyboard:'ui-keyboard',keySet:'ui-keyboard-keyset',keyButton:'ui-keyboard-button',keyWide:'ui-keyboard-widekey',keyPrefix:'ui-keyboard-',keyText:'ui-keyboard-text',keyHasActive:'ui-keyboard-hasactivestate',keyAction:'ui-keyboard-actionkey',keySpacer:'ui-keyboard-spacer',keyToggle:'ui-keyboard-toggle',keyDisabled:'ui-keyboard-disabled',locked:'ui-keyboard-lockedinput',alwaysOpen:'ui-keyboard-always-open',noKeyboard:'ui-keyboard-nokeyboard',placeholder:'ui-keyboard-placeholder',hasFocus:'ui-keyboard-has-focus',isCurrent:'ui-keyboard-input-current',inputValid:'ui-keyboard-valid-input',inputInvalid:'ui-keyboard-invalid-input',inputAutoAccepted:'ui-keyboard-autoaccepted',endRow:'ui-keyboard-button-endrow'};$keyboard.events={kbChange:'keyboardChange',kbBeforeClose:'beforeClose',kbBeforeVisible:'beforeVisible',kbVisible:'visible',kbInit:'initialized',kbInactive:'inactive',kbHidden:'hidden',kbRepeater:'repeater',kbKeysetChange:'keysetChange',inputAccepted:'accepted',inputCanceled:'canceled',inputChange:'change',inputRestricted:'restricted'};$keyboard.keyaction={accept:function(base){base.close(true);return false;},alt:function(base){base.altActive=!base.altActive;base.showSet();},bksp:function(base){base.insertText('\b');},cancel:function(base){base.close();return false;},clear:function(base){base.$preview.val('');if(base.$decBtn.length){base.checkDecimal();}},combo:function(base){var o=base.options,c=!o.useCombos,$combo=base.$keyboard.find('.'+$keyboard.css.keyPrefix+'combo');o.useCombos=c;$combo.toggleClass(o.css.buttonActive,c).attr('title',$combo.attr('data-title')+' ('+o.display[c?'active':'disabled']+')');if(c){base.checkCombos();}
return false;},dec:function(base){base.insertText((base.decimal)?'.':',');},del:function(base){base.insertText('{d}');},'default':function(base){base.shiftActive=base.altActive=base.metaActive=false;base.showSet();},enter:function(base,el,e){var tag=base.el.nodeName,o=base.options;if(e.shiftKey){return(o.enterNavigation)?base.switchInput(!e[o.enterMod],true):base.close(true);}
if(o.enterNavigation&&(tag!=='TEXTAREA'||e[o.enterMod])){return base.switchInput(!e[o.enterMod],o.autoAccept?'true':false);}
if(tag==='TEXTAREA'&&$(e.target).closest('button').length){base.insertText(($keyboard.msie?' ':'')+'\n');}},lock:function(base){base.last.keyset[0]=base.shiftActive=base.capsLock=!base.capsLock;base.showSet();},left:function(base){var p=$keyboard.caret(base.$preview);if(p.start-1>=0){base.last.start=base.last.end=p.start-1;$keyboard.caret(base.$preview,base.last);base.setScroll();}},meta:function(base,el){var $el=$(el);base.metaActive=!$el.hasClass(base.options.css.buttonActive);base.showSet($el.attr('data-name'));},next:function(base){base.switchInput(true,base.options.autoAccept);return false;},normal:function(base){base.shiftActive=base.altActive=base.metaActive=false;base.showSet();},prev:function(base){base.switchInput(false,base.options.autoAccept);return false;},right:function(base){var p=$keyboard.caret(base.$preview);if(p.start+1<=base.$preview.val().length){base.last.start=base.last.end=p.start+1;$keyboard.caret(base.$preview,base.last);base.setScroll();}},shift:function(base){base.last.keyset[0]=base.shiftActive=!base.shiftActive;base.showSet();},sign:function(base){if(/^\-?\d*\.?\d*$/.test(base.$preview.val())){base.$preview.val((base.$preview.val()*-1));}},space:function(base){base.insertText(' ');},tab:function(base){var tag=base.el.nodeName,o=base.options;if(tag==='INPUT'){if(o.tabNavigation){return base.switchInput(!base.shiftActive,true);}else{return false;}}
base.insertText('\t');},toggle:function(base){base.enabled=!base.enabled;base.toggle();},NBSP:'\u00a0',ZWSP:'\u200b',ZWNJ:'\u200c',ZWJ:'\u200d',LRM:'\u200e',RLM:'\u200f'};$keyboard.builtLayouts={};$keyboard.layouts={'alpha':{'normal':['` 1 2 3 4 5 6 7 8 9 0 - = {bksp}','{tab} a b c d e f g h i j [ ] \\','k l m n o p q r s ; \' {enter}','{shift} t u v w x y z , . / {shift}','{accept} {space} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) _ + {bksp}','{tab} A B C D E F G H I J { } |','K L M N O P Q R S : " {enter}','{shift} T U V W X Y Z < > ? {shift}','{accept} {space} {cancel}']},'qwerty':{'normal':['` 1 2 3 4 5 6 7 8 9 0 - = {bksp}','{tab} q w e r t y u i o p [ ] \\','a s d f g h j k l ; \' {enter}','{shift} z x c v b n m , . / {shift}','{accept} {space} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) _ + {bksp}','{tab} Q W E R T Y U I O P { } |','A S D F G H J K L : " {enter}','{shift} Z X C V B N M < > ? {shift}','{accept} {space} {cancel}']},'international':{'normal':['` 1 2 3 4 5 6 7 8 9 0 - = {bksp}','{tab} q w e r t y u i o p [ ] \\','a s d f g h j k l ; \' {enter}','{shift} z x c v b n m , . / {shift}','{accept} {alt} {space} {alt} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) _ + {bksp}','{tab} Q W E R T Y U I O P { } |','A S D F G H J K L : " {enter}','{shift} Z X C V B N M < > ? {shift}','{accept} {alt} {space} {alt} {cancel}'],'alt':['~ \u00a1 \u00b2 \u00b3 \u00a4 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00d7 {bksp}','{tab} \u00e4 \u00e5 \u00e9 \u00ae \u00fe \u00fc \u00fa \u00ed \u00f3 \u00f6 \u00ab \u00bb \u00ac','\u00e1 \u00df \u00f0 f g h j k \u00f8 \u00b6 \u00b4 {enter}','{shift} \u00e6 x \u00a9 v b \u00f1 \u00b5 \u00e7 > \u00bf {shift}','{accept} {alt} {space} {alt} {cancel}'],'alt-shift':['~ \u00b9 \u00b2 \u00b3 \u00a3 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00f7 {bksp}','{tab} \u00c4 \u00c5 \u00c9 \u00ae \u00de \u00dc \u00da \u00cd \u00d3 \u00d6 \u00ab \u00bb \u00a6','\u00c4 \u00a7 \u00d0 F G H J K \u00d8 \u00b0 \u00a8 {enter}','{shift} \u00c6 X \u00a2 V B \u00d1 \u00b5 \u00c7 . \u00bf {shift}','{accept} {alt} {space} {alt} {cancel}']},'colemak':{'normal':['` 1 2 3 4 5 6 7 8 9 0 - = {bksp}','{tab} q w f p g j l u y ; [ ] \\','{bksp} a r s t d h n e i o \' {enter}','{shift} z x c v b k m , . / {shift}','{accept} {space} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) _ + {bksp}','{tab} Q W F P G J L U Y : { } |','{bksp} A R S T D H N E I O " {enter}','{shift} Z X C V B K M < > ? {shift}','{accept} {space} {cancel}']},'dvorak':{'normal':['` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}','{tab} \' , . p y f g c r l / = \\','a o e u i d h t n s - {enter}','{shift} ; q j k x b m w v z {shift}','{accept} {space} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) { } {bksp}','{tab} " < > P Y F G C R L ? + |','A O E U I D H T N S _ {enter}','{shift} : Q J K X B M W V Z {shift}','{accept} {space} {cancel}']},'num':{'normal':['= ( ) {b}','{clear} / * -','7 8 9 +','4 5 6 {sign}','1 2 3 %','0 {dec} {a} {c}']}};$keyboard.language={en:{display:{'a':'\u2714:Accept (Shift+Enter)','accept':'Accept:Accept (Shift+Enter)','alt':'Alt:\u2325 AltGr','b':'\u232b:Backspace','bksp':'Bksp:Backspace','c':'\u2716:Cancel (Esc)','cancel':'Cancel:Cancel (Esc)','clear':'C:Clear','combo':'\u00f6:Toggle Combo Keys','dec':'.:Decimal','e':'\u23ce:Enter','empty':'\u00a0','enter':'Enter:Enter \u23ce','left':'\u2190','lock':'Lock:\u21ea Caps Lock','next':'Next \u21e8','prev':'\u21e6 Prev','right':'\u2192','s':'\u21e7:Shift','shift':'Shift:Shift','sign':'\u00b1:Change Sign','space':'\u00a0:Space','t':'\u21e5:Tab','tab':'\u21e5 Tab:Tab','toggle':' ','valid':'valid','invalid':'invalid','active':'active','disabled':'disabled'},wheelMessage:'Use mousewheel to see other keys',comboRegex:/([`\'~\^\"ao])([a-z])/mig,combos:{'`':{a:'\u00e0',A:'\u00c0',e:'\u00e8',E:'\u00c8',i:'\u00ec',I:'\u00cc',o:'\u00f2',O:'\u00d2',u:'\u00f9',U:'\u00d9',y:'\u1ef3',Y:'\u1ef2'},"'":{a:'\u00e1',A:'\u00c1',e:'\u00e9',E:'\u00c9',i:'\u00ed',I:'\u00cd',o:'\u00f3',O:'\u00d3',u:'\u00fa',U:'\u00da',y:'\u00fd',Y:'\u00dd'},'"':{a:'\u00e4',A:'\u00c4',e:'\u00eb',E:'\u00cb',i:'\u00ef',I:'\u00cf',o:'\u00f6',O:'\u00d6',u:'\u00fc',U:'\u00dc',y:'\u00ff',Y:'\u0178'},'^':{a:'\u00e2',A:'\u00c2',e:'\u00ea',E:'\u00ca',i:'\u00ee',I:'\u00ce',o:'\u00f4',O:'\u00d4',u:'\u00fb',U:'\u00db',y:'\u0177',Y:'\u0176'},'~':{a:'\u00e3',A:'\u00c3',e:'\u1ebd',E:'\u1ebc',i:'\u0129',I:'\u0128',o:'\u00f5',O:'\u00d5',u:'\u0169',U:'\u0168',y:'\u1ef9',Y:'\u1ef8',n:'\u00f1',N:'\u00d1'}}}};$keyboard.defaultOptions={language:null,rtl:false,layout:'qwerty',customLayout:null,position:{of:null,my:'center top',at:'center top',at2:'center bottom'},reposition:true,usePreview:true,alwaysOpen:false,initialFocus:true,noFocus:false,stayOpen:false,ignoreEsc:false,css:{input:'ui-widget-content ui-corner-all',container:'ui-widget-content ui-widget ui-corner-all ui-helper-clearfix',popup:'',buttonDefault:'ui-state-default ui-corner-all',buttonHover:'ui-state-hover',buttonAction:'ui-state-active',buttonActive:'ui-state-active',buttonDisabled:'ui-state-disabled',buttonEmpty:'ui-keyboard-empty'},autoAccept:false,autoAcceptOnEsc:false,lockInput:false,restrictInput:false,restrictInclude:'',acceptValid:false,autoAcceptOnValid:false,cancelClose:true,tabNavigation:false,enterNavigation:false,enterMod:'altKey',stopAtEnd:true,appendLocally:false,appendTo:'body',stickyShift:true,preventPaste:false,caretToEnd:false,scrollAdjustment:10,maxLength:false,maxInsert:true,repeatDelay:500,repeatRate:20,resetDefault:true,openOn:'focus',keyBinding:'mousedown touchstart',useWheel:true,useCombos:true,validate:function(keyboard,value,isClosing){return true;}};$keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/mig;$keyboard.currentKeyboard='';$('<!--[if lte IE 8]><script>jQuery("body").addClass("oldie");</script><![endif]--><!--[if IE]>'+'<script>jQuery("body").addClass("ie");</script><![endif]-->').appendTo('body').remove();$keyboard.msie=$('body').hasClass('oldie');$keyboard.allie=$('body').hasClass('ie');$keyboard.watermark=(typeof(document.createElement('input').placeholder)!=='undefined');$keyboard.checkCaretSupport=function(){if(typeof $keyboard.checkCaret!=='boolean'){var $temp=$('<div style="height:0px;width:0px;overflow:hidden;position:fixed;top:0;left:-100px;">'+'<input type="text" value="testing"/></div>').prependTo('body');$keyboard.caret($temp.find('input'),3,3);$keyboard.checkCaret=$keyboard.caret($temp.find('input').hide().show()).start!==3;$temp.remove();}
return $keyboard.checkCaret;};$keyboard.caret=function($el,param1,param2){if(!$el||!$el.length||$el.is(':hidden')||$el.css('visibility')==='hidden'){return{};}
var start,end,txt,pos,kb=$el.data('keyboard'),noFocus=kb&&kb.options.noFocus;if(!noFocus){$el.focus();}
if(typeof param1!=='undefined'){if(typeof param1==='object'&&'start'in param1&&'end'in param1){start=param1.start;end=param1.end;}else if(typeof param2==='undefined'){param2=param1;}
if(typeof param1==='number'&&typeof param2==='number'){start=param1;end=param2;}else if(param1==='start'){start=end=0;}else if(typeof param1==='string'){start=end=$el.val().length;}
return $el.caret(start,end,noFocus);}
pos=$el.caret();start=pos.start;end=pos.end;txt=($el[0].value||$el.text()||'');return{start:start,end:end,text:txt.substring(start,end),replaceStr:function(str){return txt.substring(0,start)+str+txt.substring(end,txt.length);}};};$.fn.keyboard=function(options){return this.each(function(){if(!$(this).data('keyboard')){(new $.keyboard(this,options));}});};$.fn.getkeyboard=function(){return this.data('keyboard');};$.fn.caret=function(start,end,noFocus){if(typeof this[0]==='undefined'||this.is(':hidden')||this.css('visibility')==='hidden'){return this;}
var selRange,range,stored_range,txt,val,selection=document.selection,$el=this,el=$el[0],sTop=el.scrollTop,ss=false,supportCaret=true;try{ss='selectionStart'in el;}catch(err){supportCaret=false;}
if(supportCaret&&typeof start!=='undefined'){if(!/(email|number)/i.test(el.type)){if(ss){el.selectionStart=start;el.selectionEnd=end;}else{selRange=el.createTextRange();selRange.collapse(true);selRange.moveStart('character',start);selRange.moveEnd('character',end-start);selRange.select();}}
if(!noFocus&&($el.is(':visible')||$el.css('visibility')!=='hidden')){el.focus();}
el.scrollTop=sTop;return this;}else{if(/(email|number)/i.test(el.type)){start=end=$el.val().length;}else if(ss){start=el.selectionStart;end=el.selectionEnd;}else if(selection){if(el.nodeName==='TEXTAREA'){val=$el.val();range=selection.createRange();stored_range=range.duplicate();stored_range.moveToElementText(el);stored_range.setEndPoint('EndToEnd',range);start=stored_range.text.replace(/\r/g,'\n').length;end=start+range.text.replace(/\r/g,'\n').length;}else{val=$el.val().replace(/\r/g,'\n');range=selection.createRange().duplicate();range.moveEnd('character',val.length);start=(range.text===''?val.length:val.lastIndexOf(range.text));range=selection.createRange().duplicate();range.moveStart('character',-val.length);end=range.text.length;}}else{start=end=(el.value||'').length;}
txt=(el.value||'');return{start:start,end:end,text:txt.substring(start,end),replace:function(str){return txt.substring(0,start)+str+txt.substring(end,txt.length);}};}};return $keyboard;}));